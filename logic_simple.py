
import streamlit as st
import random
def confidence_letter(score: float):
    """0.0ã€œ1.0ã‚’A/B/Cã®ç¢ºã‹ã‚‰ã—ã•ã«å¤‰æ›"""
    if score >= 0.8: return "A", "é«˜ã„ï¼ˆã‹ãªã‚Šå½“ã¦ã¯ã¾ã‚Šãã†ï¼‰"
    if score >= 0.6: return "B", "ä¸­ãã‚‰ã„ï¼ˆãã‚Œã£ã½ã„ãŒä»–ã®å¯èƒ½æ€§ã‚‚ï¼‰"
    return "C", "ä½ã‚ï¼ˆå‚è€ƒç¨‹åº¦ï¼‰"

import streamlit as st  # â†å…ˆé ­ã«å…¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

def render_finding_card(f: dict):
    # å®‰å…¨ãªå–ã‚Šå‡ºã—ï¼ˆå‹ã‚‚æ•´ãˆã‚‹ï¼‰
    label = str(f.get("label", "ï¼ˆåç§°æœªè¨­å®šï¼‰"))
    score = float(f.get("score", 0.0) or 0.0)
    tips  = list(f.get("suggestions") or [])
    evid  = list(f.get("evidence") or [])
    why   = str(f.get("why", ""))

    st.markdown(f'<div class="card"><b>{label}</b>'
                f'<span class="badge">ç¢ºã‹ã‚‰ã—ã•: {score:.2f}</span></div>',
                unsafe_allow_html=True)

    if why:
        st.markdown(f"**ãªãœï¼Ÿï¼ˆçŸ­ã„èª¬æ˜ï¼‰**ã€€{why}")

    if evid:
        st.caption("ãƒ’ãƒ³ãƒˆã«ãªã£ãŸè¨€è‘‰: " + "ã€".join(map(str, evid[:3])))

    if tips:
        st.markdown("**ã™ãè©¦ã›ã‚‹å¯¾å‡¦**")
        for t in tips[:4]:
            st.markdown("- " + str(t))


def analyze_selection(theme: str, situation: str, sign: str, text: str):
    """
    ã‹ã‚“ãŸã‚“ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼š
      - A/B/Cå„ã‚¹ãƒ†ãƒƒãƒ—ã®çµ„ã¿åˆã‚ã›ã¨ã€ãƒ†ã‚­ã‚¹ãƒˆå†…ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰
        ä»£è¡¨çš„ãªãƒã‚¤ã‚¢ã‚¹å€™è£œã‚’è¿”ã™
    """
    text = (text or "").lower()

    # å€™è£œè¾æ›¸ï¼šåˆ†ã‹ã‚Šã‚„ã™ã„æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ï¼‹ã‚„ã•ã—ã„èª¬æ˜ï¼‹è¡Œå‹•ãƒ’ãƒ³ãƒˆ
    BIASES = [
        {
            "key": "loss_aversion",
            "label": "æå¤±å›é¿ï¼ˆæã‚’å¼·ãé¿ã‘ãŸããªã‚‹ï¼‰",
            "why": "äººã¯åŒã˜é‡ã®å¾—ã‚ˆã‚Šã€åŒã˜é‡ã®æã‚’2å€ãã‚‰ã„å¼·ãæ„Ÿã˜ãŒã¡ã§ã™ã€‚",
            "match": lambda th, si, sg, tx: ("æ" in sg) or ("æ" in tx) or (th=="è²·ã„ç‰©" and "ã‚»ãƒ¼ãƒ«" in tx),
            "tips": [
                "æã§ã¯ãªãâ€œåˆè¨ˆã„ãã‚‰æ‰•ã†ã‹â€ã§è¦‹ã‚‹ï¼ˆ%ã§ã¯ãªãå††ãƒ»æ™‚é–“ã«è¨€ã„æ›ãˆã‚‹ï¼‰",
                "è²·ã‚ãªã„é¸æŠã‚‚å€™è£œã«å…¥ã‚Œã¦3ã¤ã®æ¡ˆã‚’æ¯”ã¹ã‚‹",
                "ä¸€æ™©ãŠã„ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦åˆ¤æ–­ã™ã‚‹ï¼ˆ24æ™‚é–“ãƒ«ãƒ¼ãƒ«ï¼‰"
            ],
            "score": lambda th, si, sg, tx: 0.8 if ("æ" in sg or "ã‚»ãƒ¼ãƒ«" in tx) else 0.65
        },
        {
            "key": "anchoring",
            "label": "ã‚¢ãƒ³ã‚«ãƒªãƒ³ã‚°ï¼ˆæœ€åˆã®æ•°å­—ã«å¼•ã£ã±ã‚‰ã‚Œã‚‹ï¼‰",
            "why": "æœ€åˆã«è¦‹ãŸå®šä¾¡ã‚„ç‚¹æ•°ãŒâ€œåŸºæº–â€ã«ãªã£ã¦ã€ãã®å¾Œã®åˆ¤æ–­ãŒã‚†ãŒã¿ã¾ã™ã€‚",
            "match": lambda th, si, sg, tx: ("å®šä¾¡" in tx) or ("å…ƒå€¤" in tx) or ("ã‚»ãƒ¼ãƒ«" in tx),
            "tips": [
                "æ¯”ã¹ã‚‹æ•°å­—ã‚’2ã¤ä»¥ä¸Šã«ã™ã‚‹ï¼ˆç›¸å ´ãƒ»ãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ¼ãƒˆã‚’è¦‹ã‚‹ï¼‰",
                "â€œä»Šã®è‡ªåˆ†ã«å¿…è¦ã‹â€ã§åˆ¤æ–­ã™ã‚‹ï¼ˆæ•°å­—ã ã‘ã§æ±ºã‚ãªã„ï¼‰"
            ],
            "score": lambda th, si, sg, tx: 0.7 if ("å®šä¾¡" in tx or "å…ƒå€¤" in tx) else 0.6
        },
        {
            "key": "framing",
            "label": "ãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°åŠ¹æœï¼ˆè¨€ã„æ–¹ã§å°è±¡ãŒå¤‰ã‚ã‚‹ï¼‰",
            "why": "ã€90%æˆåŠŸã€ã¨ã€10%å¤±æ•—ã€ã¯ä¸­èº«ãŒåŒã˜ã§ã‚‚æ„Ÿã˜æ–¹ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚",
            "match": lambda th, si, sg, tx: ("æˆåŠŸ" in tx and "å¤±æ•—" in tx) or (th in ["è²·ã„ç‰©","ãŠé‡‘"] and "å‰²å¼•" in tx),
            "tips": [
                "åˆ¥ã®è¨€ã„æ–¹ã«è¨€ã„æ›ãˆã¦ã‹ã‚‰åˆ¤æ–­ï¼ˆ%â‡”å††ã€å¾—â‡”æï¼‰",
                "ç¬¬ä¸‰è€…ã®çŸ­è©•ã‚’3è¡Œã§æ›¸ãï¼ˆå¤–éƒ¨è¦–ç‚¹ï¼‰"
            ],
            "score": lambda th, si, sg, tx: 0.6
        },
        {
            "key": "status_quo",
            "label": "ç¾çŠ¶ç¶­æŒãƒã‚¤ã‚¢ã‚¹ï¼ˆå¤‰ãˆãªã„æ–¹ã‚’é¸ã³ã‚„ã™ã„ï¼‰",
            "why": "äººã¯æ…£ã‚ŒãŸçŠ¶æ…‹ã‚’å¥½ã¿ã¾ã™ã€‚å¤‰ãˆã‚‹ã®ãŒæ‚ªã„ã‚ã‘ã§ã¯ãªãæº–å‚™ãŒå¿…è¦ãªã ã‘ã€‚",
            "match": lambda th, si, sg, tx: ("é¢å€’" in sg) or ("ã„ã¤ã‚‚é€šã‚Š" in tx) or ("å…ˆã®ã°ã—" in sg),
            "tips": [
                "â€œã‚„ã‚‹ãªã‚‰æœ€åˆã®1æ­©ã ã‘â€ã‚’æ±ºã‚ã‚‹ï¼ˆ5åˆ†ã ã‘ãƒ»1å•ã ã‘ï¼‰",
                "ã‚„ã‚‰ãªã„ã‚³ã‚¹ãƒˆï¼ˆæ™‚é–“ãƒ»ãŠé‡‘ãƒ»æ©Ÿä¼šï¼‰ã‚’æ›¸ãå‡ºã™"
            ],
            "score": lambda th, si, sg, tx: 0.65 if ("é¢å€’" in sg or "å…ˆã®ã°ã—" in sg) else 0.55
        },
        {
            "key": "bandwagon",
            "label": "åŒèª¿ãƒã‚¤ã‚¢ã‚¹ï¼ˆã¿ã‚“ãªã«åˆã‚ã›ã™ãã‚‹ï¼‰",
            "why": "ã€ã¿ã‚“ãªã‚„ã£ã¦ã‚‹ã€ã¯å®‰å¿ƒã™ã‚‹ã‘ã©ã€è‡ªåˆ†ã«åˆã†ã‹ã¯åˆ¥å•é¡Œã§ã™ã€‚",
            "match": lambda th, si, sg, tx: ("ã¿ã‚“ãª" in sg) or ("æµè¡Œ" in tx),
            "tips": [
                "åˆ©ç‚¹ã¨ä¸å®‰ã‚’1è¡Œãšã¤æ›¸ãå‡ºã—â€œè‡ªåˆ†ã®ç›®çš„â€ã«åˆã†ã‹ç¢ºèª",
                "åˆã‚ãªã„æ‰€ã ã‘åˆ¥ã®æ–¹æ³•ã‚’æ¢ã™ï¼ˆå…¨éƒ¨ãƒãƒã—ãªãã¦OKï¼‰"
            ],
            "score": lambda th, si, sg, tx: 0.6
        },
        {
            "key": "affect",
            "label": "æ„Ÿæƒ…ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ï¼ˆä¸å®‰ã‚„ç„¦ã‚Šã§åˆ¤æ–­ã—ãŒã¡ï¼‰",
            "why": "å¼·ã„æ„Ÿæƒ…ã¯ã€ä»Šã™ãæ±ºã‚ãŸã„ï¼ã€ã‚’ç”Ÿã¿ã€æå¾—ã®è¦‹ãˆæ–¹ã‚’å¤‰ãˆã¾ã™ã€‚",
            "match": lambda th, si, sg, tx: ("ä¸å®‰" in sg) or ("ç„¦" in tx) or ("æ€–" in tx),
            "tips": [
                "æ·±å‘¼å¸â†’10åˆ†å¾Œã®è‡ªåˆ†ãŒä½•ã¨è¨€ã†ã‹ã‚’æ›¸ã„ã¦ã¿ã‚‹ï¼ˆå¤–éƒ¨è¦–ç‚¹ï¼‰",
                "ã„ã¾æ±ºã‚ãªã„ï¼ˆ24æ™‚é–“ãƒ«ãƒ¼ãƒ«ï¼‰"
            ],
            "score": lambda th, si, sg, tx: 0.7 if ("ç„¦" in tx or "æ€–" in tx) else 0.6
        },
    ]

    hits = []
    for spec in BIASES:
        if spec["match"](theme, situation, sign, text):
            hits.append({
                "label": spec["label"],
                "why": spec["why"],
                "evidence": [theme, situation, sign] + ([w for w in ["ã‚»ãƒ¼ãƒ«","å®šä¾¡","å…ƒå€¤","æˆåŠŸ","å¤±æ•—","ç„¦","æ€–","ä¸å®‰"] if w in text])[:3],
                "suggestions": spec["tips"],
                "score": spec["score"](theme, situation, sign, text),
            })

    # é‡è¤‡ã‚„ä¼¼ãŸã‚‚ã®ã‚’ä¸Šé™3ä»¶ã«
    hits = sorted(hits, key=lambda x: x["score"], reverse=True)[:3]
    return hits

# ================================
# ğŸ”§ èª²é‡‘ãªã—ç‰ˆï¼š30ãƒã‚¤ã‚¢ã‚¹å¯¾å¿œã®ãƒ—ãƒè¨ºæ–­ã‚¨ãƒ³ã‚¸ãƒ³
# ================================
import re, random

_BIASES = [
    # 1 ç¢ºè¨¼ãƒã‚¤ã‚¢ã‚¹
    {"key":"confirmation","name":"ç¢ºè¨¼ãƒã‚¤ã‚¢ã‚¹",
     "desc":"è‡ªåˆ†ãŒä¿¡ã˜ãŸã„çµè«–ã«åˆã†æƒ…å ±ã ã‘ã‚’é‡è¦–ã—ã€åå¯¾æƒ…å ±ã‚’ç„¡è¦–ã—ãŒã¡ãªå‚¾å‘ã€‚",
     "patterns":[r"çµ¶å¯¾(ã«)?", r"é–“é•ã„ãªã„", r"éƒ½åˆã®æ‚ªã„.*ç„¡è¦–", r"è‡ªåˆ†(ã®|ãŸã¡ã®)æ„è¦‹ã ã‘", r"åå¯¾(æ„è¦‹|æƒ…å ±)ã¯(è¦‹ãªã„|è¦ã‚‰ãªã„)"],
     "advice":[
         "åå¯¾æ„è¦‹ãƒ»åä¾‹ã‚’3ã¤é›†ã‚ã¦ã‹ã‚‰åˆ¤æ–­ã—ã¾ã—ã‚‡ã†ã€‚",
         "æ”¯æŒãƒ‡ãƒ¼ã‚¿ã¨åè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’**åŒæ•°**ä¸¦ã¹ã¦æ¯”è¼ƒã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 2 åˆ©ç”¨å¯èƒ½æ€§ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯
    {"key":"availability","name":"åˆ©ç”¨å¯èƒ½æ€§ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯",
     "desc":"å°è±¡ã«æ®‹ã‚‹äº‹ä¾‹ã‚’éå¤§è©•ä¾¡ã—ã€å…¨ä½“ã®é »åº¦ã‚„ç¢ºç‡ã‚’æ­ªã‚ã‚‹å‚¾å‘ã€‚",
     "patterns":[r"æœ€è¿‘(ã‚ˆã|é »ç¹ã«)è¦‹ã‚‹", r"ãƒ‹ãƒ¥ãƒ¼ã‚¹ã§(é€£æ—¥|æ¯æ—¥)", r"(ä¸€ä»¶|æ•°ä»¶)ã®(äº‹ä»¶|äº‹ä¾‹)ã§(å…¨éƒ¨|å…¨ä½“)ã‚’åˆ¤æ–­"],
     "advice":[
         "æ¯æ•°ã‚„æ¯é›†å›£ã®**ç·æ•°**ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚",
         "å¼·ã„äº‹ä¾‹ã‚ˆã‚Š**åŸºç¤çµ±è¨ˆ**ã‚’å„ªå…ˆã—ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 3 ã‚¢ãƒ³ã‚«ãƒªãƒ³ã‚°
    {"key":"anchoring","name":"ã‚¢ãƒ³ã‚«ãƒªãƒ³ã‚°",
     "desc":"æœ€åˆã«è¦‹ãŸæ•°å­—ã‚„æƒ…å ±ãŒåŸºæº–ã«ãªã‚Šã€å¾Œã®åˆ¤æ–­ã‚’å¼•ããšã‚‹ç¾è±¡ã€‚",
     "patterns":[r"æœ€åˆ(ã«|ã®)ä¾¡æ ¼", r"ç¬¬ä¸€å°è±¡", r"\d+%?å¼•ã", r"åˆå›ã®æƒ…å ±ãŒåŸºæº–"],
     "advice":[
         "æœ€åˆã®æ•°å­—ã‚’ä¸€æ—¦éš ã—ã€ç‹¬ç«‹ã—ã¦è¦‹ç©ã‚‚ã‚Šç›´ã—ã¾ã—ã‚‡ã†ã€‚",
         "ä»£æ›¿æƒ…å ±æºã‚’2ã¤ä»¥ä¸ŠåŠ ãˆã¦æ¯”è¼ƒã—ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 4 ãƒãƒ³ãƒ‰ãƒ¯ã‚´ãƒ³åŠ¹æœ
    {"key":"bandwagon","name":"ãƒãƒ³ãƒ‰ãƒ¯ã‚´ãƒ³åŠ¹æœ",
     "desc":"ã€ã¿ã‚“ãªãŒãã†ã—ã¦ã„ã‚‹ã‹ã‚‰ã€ã§åˆ¤æ–­ãŒå·¦å³ã•ã‚Œã‚‹ç¾è±¡ã€‚",
     "patterns":[r"ã¿ã‚“ãª(ãŒ|ã‚‚)", r"æµè¡Œ(ã ã‹ã‚‰|ã£ã¦ã‚‹)", r"å‘¨ã‚ŠãŒ(ã‚„ã£ã¦ã‚‹|è²·ã£ã¦ã‚‹|è¨€ã£ã¦ã‚‹)"],
     "advice":[
         "â€œè‡ªåˆ†ã«ã¨ã£ã¦ã®åˆ©ç‚¹/æ¬ ç‚¹â€ã§å†è©•ä¾¡ã—ã¾ã—ã‚‡ã†ã€‚",
         "äººæ°—ã®**æ ¹æ‹ **ï¼ˆå“è³ª/ä¾¡æ ¼/ä»£æ›¿ï¼‰ã‚’ç®‡æ¡æ›¸ãæ¯”è¼ƒã—ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 5 ãƒãƒ­ãƒ¼åŠ¹æœ
    {"key":"halo","name":"ãƒãƒ­ãƒ¼åŠ¹æœ",
     "desc":"ç›®ç«‹ã¤ç‰¹å¾´ãŒä»–ã®è©•ä¾¡ã¾ã§è‰¯ã/æ‚ªãè¦‹ã›ã¦ã—ã¾ã†ç¾è±¡ã€‚",
     "patterns":[r"(æœ‰å|äººæ°—|é«˜è©•ä¾¡)ã ã‹ã‚‰", r"è‚©æ›¸ããŒ(ã‚ã‚‹|ç«‹æ´¾)ã ã‹ã‚‰", r"è¦‹ãŸç›®ãŒ(è‰¯ã„|æ‚ªã„)ã®ã§"],
     "advice":[
         "é …ç›®ã”ã¨ã«ç‹¬ç«‹ã—ã¦è©•ä¾¡è¡¨ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚",
         "æƒ…å ±æºã‚’åˆ†ã‘ã¦**ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰è©•ä¾¡**ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 6 æ¨©å¨ãƒã‚¤ã‚¢ã‚¹
    {"key":"authority","name":"æ¨©å¨ãƒã‚¤ã‚¢ã‚¹",
     "desc":"å°‚é–€å®¶ã‚„è‚©æ›¸ãã®ã‚ã‚‹äººã®æ„è¦‹ã‚’éåº¦ã«ä¿¡é ¼ã—ã¦ã—ã¾ã†å‚¾å‘ã€‚",
     "patterns":[r"(å°‚é–€å®¶|åŒ»è€…|æ•™æˆ|æœ‰åäºº)ãŒè¨€ã£ã¦ãŸ", r"ãƒ†ãƒ¬ãƒ“(ã§|ãŒ)è¨€ã£ã¦ãŸ", r"å…¬å¼ã ã‹ã‚‰æ­£ã—ã„"],
     "advice":[
         "ä¸»å¼µã®**æ ¹æ‹ **ï¼ˆãƒ‡ãƒ¼ã‚¿/æ–¹æ³•ï¼‰ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚",
         "åˆ¥ã®å°‚é–€å®¶ã®è¦‹è§£ã‚‚**2è€…ä»¥ä¸Š**å‚ç…§ã—ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 7 è‡ªå·±å¥‰ä»•ãƒã‚¤ã‚¢ã‚¹
    {"key":"selfserving","name":"è‡ªå·±å¥‰ä»•ãƒã‚¤ã‚¢ã‚¹",
     "desc":"æˆåŠŸã¯è‡ªåˆ†ã®æ‰‹æŸ„ã€å¤±æ•—ã¯ä»–è€…ã‚„ç’°å¢ƒã®ã›ã„ã«ã—ãŒã¡ã€‚",
     "patterns":[r"æˆåŠŸã¯è‡ªåˆ†(ã®|ãŒ)é ‘å¼µã£ãŸ", r"å¤±æ•—ã¯(é‹|ç’°å¢ƒ|ä»–äºº)ã®ã›ã„", r"ç§ã¯æ‚ªããªã„"],
     "advice":[
         "æˆåŠŸ/å¤±æ•—ã¨ã‚‚ã«**å†…çš„è¦å› ãƒ»å¤–çš„è¦å› **ã‚’ä¸¡æ–¹æ›¸ãå‡ºã—ã¾ã—ã‚‡ã†ã€‚",
         "ç¬¬ä¸‰è€…ã®è¦–ç‚¹ã§**äº‹å®Ÿåˆ—æŒ™**ã‚’è©¦ã—ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 8 å¾ŒçŸ¥æµãƒã‚¤ã‚¢ã‚¹
    {"key":"hindsight","name":"å¾ŒçŸ¥æµãƒã‚¤ã‚¢ã‚¹",
     "desc":"çµæœã‚’çŸ¥ã£ãŸå¾Œã§ã€æœ€åˆã‹ã‚‰äºˆæ¸¬ã§ããŸã¨éŒ¯è¦šã™ã‚‹ç¾è±¡ã€‚",
     "patterns":[r"æœ€åˆã‹ã‚‰(åˆ†ã‹ã£ã¦ãŸ|ãã†æ€ã£ã¦ãŸ)", r"ã‚„ã£ã±ã‚Š(ãã†|äºˆæƒ³é€šã‚Š)"],
     "advice":[
         "å½“æ™‚ã®**ä¸ç¢ºå®Ÿæ€§**ã¨ä»£æ›¿ã‚·ãƒŠãƒªã‚ªã‚’æ›¸ãå‡ºã—ã¾ã—ã‚‡ã†ã€‚",
         "æ±ºå®šå‰ã®ãƒ¡ãƒ¢ã‚„ãƒ­ã‚°ã§**è¨¼è·¡ç¢ºèª**ã‚’ã€‚"
     ]},

    # 9 ç¾çŠ¶ç¶­æŒãƒã‚¤ã‚¢ã‚¹
    {"key":"statusquo","name":"ç¾çŠ¶ç¶­æŒãƒã‚¤ã‚¢ã‚¹",
     "desc":"å¤‰åŒ–ã‚ˆã‚Šç¾çŠ¶ã‚’éåº¦ã«å¥½ã‚€å‚¾å‘ã€‚",
     "patterns":[r"ä»Šã®ã¾ã¾ã§è‰¯ã„", r"å¤‰æ›´ã¯(é¢å€’|ãƒªã‚¹ã‚¯)ã ", r"å‰ä¾‹ãŒãªã„"],
     "advice":[
         "å¤‰ãˆãªã„ã‚³ã‚¹ãƒˆ/ãƒªã‚¹ã‚¯ã‚‚**æ•°å€¤åŒ–**ã—ã¦æ¯”è¼ƒã€‚",
         "å°ã•ãªå®Ÿé¨“ï¼ˆPoCï¼‰ã§ä½ãƒªã‚¹ã‚¯ã«è©¦ã—ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 10 æ­£å¸¸æ€§ãƒã‚¤ã‚¢ã‚¹
    {"key":"normalcy","name":"æ­£å¸¸æ€§ãƒã‚¤ã‚¢ã‚¹",
     "desc":"éƒ½åˆã®æ‚ªã„äº‹æ…‹ã®å¯èƒ½æ€§ã‚’éå°è©•ä¾¡ã—ã€å¤§ä¸ˆå¤«ã€ã¨æ€ã„è¾¼ã‚€å‚¾å‘ã€‚",
     "patterns":[r"è‡ªåˆ†ã¯å¤§ä¸ˆå¤«", r"ãã‚“ãª(äº‹æ•…|ç½å®³)èµ·ã“ã‚‰ãªã„", r"éå»ã‚‚ç„¡äº‹ã ã£ãŸ"],
     "advice":[
         "æœ€æ‚ªã‚±ãƒ¼ã‚¹ã‚’**å…·ä½“åŒ–**ã—ã€å¯¾ç­–ã‚’1ã¤å®Ÿè¡Œã€‚",
         "è¿‘ã„äº‹ä¾‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã¦**ç¢ºç‡**ã‚’æŠŠæ¡ã—ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 11 ãƒã‚¬ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒã‚¤ã‚¢ã‚¹
    {"key":"negativity","name":"ãƒã‚¬ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒã‚¤ã‚¢ã‚¹",
     "desc":"æ‚ªã„æƒ…å ±ã«éåº¦ã«æ³¨æ„ãŒå‘ãã€åˆ¤æ–­ãŒæ‚²è¦³ã«åã‚‹å‚¾å‘ã€‚",
     "patterns":[r"æ‚ªã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã°ã‹ã‚Š", r"ã©ã†ã›å¤±æ•—ã™ã‚‹", r"å±ãªã„(ã‹ã‚‰|ã®ã§)ã‚„ã‚ã‚‹"],
     "advice":[
         "ãƒã‚¸/ãƒã‚¬æƒ…å ±ã‚’**å¯¾**ã§åé›†ã—ãƒãƒ©ãƒ³ã‚¹é–²è¦§ã€‚",
         "â€œã†ã¾ãã„ãæ¡ä»¶â€ã‚’**å…·ä½“**ã«æ›¸ãå‡ºã—ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 12 ã‚µãƒ³ã‚¯ã‚³ã‚¹ãƒˆåŠ¹æœ
    {"key":"sunkcost","name":"ã‚µãƒ³ã‚¯ã‚³ã‚¹ãƒˆåŠ¹æœ",
     "desc":"å›åä¸èƒ½ãªæŠ•è³‡ã‚’ç†ç”±ã«ã€éåˆç†ãªç¶™ç¶šã‚’ã—ã¦ã—ã¾ã†ç¾è±¡ã€‚",
     "patterns":[r"ã“ã“ã¾ã§(æ™‚é–“|ãŠé‡‘)ã‚’ã‹ã‘ãŸ", r"ã‚‚ã£ãŸã„ãªã„ã‹ã‚‰ç¶šã‘ã‚‹", r"ã‚„ã‚ãŸã‚‰æ"],
     "advice":[
         "â€œä»Šã‹ã‚‰â€ã®è²»ç”¨å¯¾åŠ¹æœã ã‘ã§åˆ¤æ–­ã—ã¾ã—ã‚‡ã†ã€‚",
         "çµ‚äº†æ¡ä»¶ã‚’**äº‹å‰ã«**æ•°å€¤ã§æ±ºã‚ã¦ãŠãã€‚"
     ]},

    # 13 å¸Œå°‘æ€§ãƒã‚¤ã‚¢ã‚¹
    {"key":"scarcity","name":"å¸Œå°‘æ€§ãƒã‚¤ã‚¢ã‚¹",
     "desc":"å¸Œå°‘ãƒ»é™å®šãƒ»æ®‹ã‚Šã‚ãšã‹ã¨ã„ã†æƒ…å ±ã§ä¾¡å€¤ã‚’éå¤§è©•ä¾¡ã™ã‚‹å‚¾å‘ã€‚",
     "patterns":[r"é™å®š|æ®‹ã‚Šã‚ãšã‹|ä»Šã ã‘|å…ˆç€", r"å¸Œå°‘(ä¾¡å€¤|å“)ã ã‹ã‚‰"],
     "advice":[
         "æœ¬æ¥ä¾¡å€¤ï¼ˆå“è³ª/ä»£æ›¿/ç”¨é€”ï¼‰ã§è©•ä¾¡ã—ç›´ã—ã¾ã—ã‚‡ã†ã€‚",
         "ä¸€æ™©å¯ã‹ã›ã‚‹**ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³**ã‚’å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 14 ãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°åŠ¹æœ
    {"key":"framing","name":"ãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°åŠ¹æœ",
     "desc":"åŒã˜å†…å®¹ã§ã‚‚è¡¨ç¾æ–¹æ³•ï¼ˆ90%æˆåŠŸ vs 10%å¤±æ•—ï¼‰ã§åˆ¤æ–­ãŒå¤‰ã‚ã‚‹ç¾è±¡ã€‚",
     "patterns":[r"\d+%æˆåŠŸ", r"\d+%å¤±æ•—", r"è¨€ã„æ›ãˆã§å°è±¡ãŒå¤‰ã‚ã‚‹"],
     "advice":[
         "åå¯¾å´ã®è¡¨ç¾ã«**è¨€ã„æ›ãˆ**ã¦å†è©•ä¾¡ã€‚",
         "çµ¶å¯¾æ•°ã¨å‰²åˆã®**ä¸¡æ–¹**ã§æ¯”è¼ƒã—ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 15 ä»£è¡¨æ€§ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯
    {"key":"representativeness","name":"ä»£è¡¨æ€§ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯",
     "desc":"å…¸å‹åƒã«å½“ã¦ã¯ã¾ã‚‹ã‹ã©ã†ã‹ã§ç¢ºç‡ã‚’åˆ¤æ–­ã—ã¦ã—ã¾ã†å‚¾å‘ã€‚",
     "patterns":[r"ã€œã£ã½ã„ã‹ã‚‰(å¤§ä¸ˆå¤«|å±ãªã„)", r"è¦‹ãŸç›®(çš„|ã‹ã‚‰)ã«", r"â—‹â—‹ç³»ã®äººã¯â€¦"],
     "advice":[
         "**äº‹å‰ç¢ºç‡**ï¼ˆãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ¼ãƒˆï¼‰ã‚’ç¢ºèªã€‚",
         "å…¸å‹åƒã‹ã‚‰é›¢ã‚ŒãŸ**åä¾‹**ã‚‚è¦‹ã¾ã—ã‚‡ã†ã€‚"
     ]},

    # 16 æ—©è¨ˆãªä¸€èˆ¬åŒ–
    {"key":"overgeneralization","name":"æ—©è¨ˆãªä¸€èˆ¬åŒ–",
     "desc":"å°‘æ•°ã®äº‹ä¾‹ã‹ã‚‰å…¨ä½“ã‚’æ–­å®šã—ã¦ã—ã¾ã†æ¨è«–ã®é£›èºã€‚",
     "patterns":[r"(ä¸€äºº|ä¸€ä»¶|ä¸€åº¦|ãŸã£ãŸæ•°ä»¶).*(å…¨éƒ¨|ã„ã¤ã‚‚|å¿…ãš|æ—¥æœ¬ã¯|ä¸–ç•Œã¯)", r"ä¸€ä¾‹ã‚’æ ¹æ‹ ã«å…¨ä½“ã‚’æ–­å®š"],
     "advice":[
         "åä¾‹ã‚’æœ€ä½2ã¤æ¢ã—ã€é©ç”¨ç¯„å›²ã‚’**é™å®š**ã€‚",
         "æ¡ä»¶ã‚’æ›¸ãå‡ºã—ã¦**å¢ƒç•Œ**ã‚’æ˜ç¢ºã«ã€‚"
     ]},

    # 17 å› æœã®å–ã‚Šé•ãˆï¼ˆç›¸é–¢ã¨å› æœã®æ··åŒï¼‰
    {"key":"causation","name":"å› æœã®å–ã‚Šé•ãˆï¼ˆç›¸é–¢ã¨å› æœã®æ··åŒï¼‰",
     "desc":"åŒæ™‚ã«èµ·ãã¦ã„ã‚‹ã ã‘ã§ã€å› æœé–¢ä¿‚ãŒã‚ã‚‹ã¨èª¤è§£ã™ã‚‹ã“ã¨ã€‚",
     "patterns":[r"ã ã‹ã‚‰.*ãªã£ãŸ", r"ä¸€ç·’ã«å¢—ãˆãŸ", r"åŒæ™‚ã«èµ·ããŸ=åŸå› "],
     "advice":[
         "ç¬¬3ã®è¦å› ï¼ˆäº¤çµ¡ï¼‰ã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚",
         "æ™‚ç³»åˆ—ã¨**åäº‹å®Ÿ**ï¼ˆãªã‹ã£ãŸã‚‰ï¼Ÿï¼‰ã‚’ç¢ºèªã€‚"
     ]},

    # 18 æ„Ÿæƒ…ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯
    {"key":"affect","name":"æ„Ÿæƒ…ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯",
     "desc":"å¥½ãå«Œã„ãƒ»æã‚Œãƒ»ä¸å®‰ãªã©æ„Ÿæƒ…ã§ç´ æ—©ãåˆ¤æ–­ã—ã¦ã—ã¾ã†å‚¾å‘ã€‚",
     "patterns":[r"ãªã‚“ã‹(å¥½ã|å«Œã„)", r"æ€–ã„ã‹ã‚‰ã‚„ã‚ã‚‹", r"ãƒ ã‚«ã¤ãã®ã§ç„¡ç†"],
     "advice":[
         "æ„Ÿæƒ…ã¨äº‹å®Ÿã‚’**åˆ¥æ¬„**ã«åˆ†ã‘ã¦æ•´ç†ã€‚",
         "åˆ¤æ–­ã¯**ç¿Œæ—¥**ã«å›ã™ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã€‚"
     ]},

    # 19 è‡ªå·±ä¸­å¿ƒãƒã‚¤ã‚¢ã‚¹
    {"key":"egocentric","name":"è‡ªå·±ä¸­å¿ƒãƒã‚¤ã‚¢ã‚¹",
     "desc":"è‡ªåˆ†ã®è¦‹æ–¹ãŒä¸€èˆ¬çš„ã ã¨æ€ã„è¾¼ã¿ã€ä»–è€…ã®è¦–ç‚¹ã‚’éå°è©•ä¾¡ã™ã‚‹å‚¾å‘ã€‚",
     "patterns":[r"æ™®é€šã¯(ã“ã†|ã“ã†æ€ã†)", r"ã¿ã‚“ãª(ãã†|åŒã˜)ã¯ãš", r"è‡ªåˆ†ãŒæ­£ã—ã„"],
     "advice":[
         "é–¢ä¿‚è€…**3åä»¥ä¸Š**ã®è¦–ç‚¹ã‚’æ›¸ãå‡ºã™ã€‚",
         "â€œè‡ªåˆ†ã®çŸ¥ã‚‰ãªã„å‰æâ€ãŒãªã„ã‹ç¢ºèªã€‚"
     ]},

    # 20 é›†å›£åŒèª¿ãƒã‚¤ã‚¢ã‚¹
    {"key":"conformity","name":"é›†å›£åŒèª¿ãƒã‚¤ã‚¢ã‚¹",
     "desc":"å‘¨å›²ã«åˆã‚ã›ã‚‹åœ§åŠ›ã§ã€ç•°ãªã‚‹æ„è¦‹ã‚’å‡ºã—ã«ãããªã‚‹ç¾è±¡ã€‚",
     "patterns":[r"ç©ºæ°—ã‚’èª­ã‚€", r"åå¯¾ã™ã‚‹ã¨(æµ®ã|é¢å€’)", r"ä¼šè­°ã§æ²ˆé»™"],
     "advice":[
         "åŒ¿åã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã§**äº‹å‰ã«**æ„è¦‹åé›†ã€‚",
         "â€œåå¯¾å½¹â€ã‚’**å½¹å‰²ã¨ã—ã¦**ç½®ãã€‚"
     ]},

    # 21 å†…é›†å›£ãƒã‚¤ã‚¢ã‚¹
    {"key":"ingroup","name":"å†…é›†å›£ãƒã‚¤ã‚¢ã‚¹",
     "desc":"æ‰€å±é›†å›£ã‚’éåº¦ã«å¥½æ„çš„ã«æ‰ãˆã‚‹å‚¾å‘ã€‚",
     "patterns":[r"ã†ã¡(ã®|ã‚‰)ã¯å„ªç§€", r"åŒã˜(å¤§å­¦|ä¼šç¤¾|å›½)ã ã‹ã‚‰ä¿¡ç”¨"],
     "advice":[
         "å¤–éƒ¨ã®è©•ä¾¡æŒ‡æ¨™ã‚„**ç¬¬ä¸‰è€…**ã®æ„è¦‹ã§æ¤œè¨¼ã€‚",
         "ä»–é›†å›£ã®**å¼·ã¿**ã‚‚åˆ—æŒ™ã€‚"
     ]},

    # 22 å¤–é›†å›£ãƒã‚¤ã‚¢ã‚¹
    {"key":"outgroup","name":"å¤–é›†å›£ãƒã‚¤ã‚¢ã‚¹",
     "desc":"è‡ªåˆ†ãŒå±ã•ãªã„é›†å›£ã‚’ä¸€æ‹¬ã‚Šã«ã—ã€å¦å®šçš„ã«æ‰ãˆã‚‹å‚¾å‘ã€‚",
     "patterns":[r"ä»–å›½ã®äººã¯.*ã ", r"â—‹â—‹äººã¯(ã¿ã‚“ãª|å…¨å“¡)", r"ã‚ã®ç•Œéšˆã¯(ãƒ€ãƒ¡|å±é™º)"],
     "advice":[
         "å€‹äººå·®ã¨**å¤šæ§˜æ€§**ã«æ³¨ç›®ã€‚äº‹ä¾‹ã‚’**è¤‡æ•°**æ¯”è¼ƒã€‚",
         "çµ±è¨ˆã‚„ä¸€æ¬¡æƒ…å ±ã«è§¦ã‚Œã¦**å®Ÿåƒ**ã‚’ç¢ºèªã€‚"
     ]},

    # 23 ã‚¢ã‚¦ãƒˆã‚«ãƒ ãƒã‚¤ã‚¢ã‚¹
    {"key":"outcome","name":"ã‚¢ã‚¦ãƒˆã‚«ãƒ ãƒã‚¤ã‚¢ã‚¹",
     "desc":"çµæœã®è‰¯ã—æ‚ªã—ã§ã€æ„æ€æ±ºå®šã®è³ªã¾ã§è©•ä¾¡ã—ã¦ã—ã¾ã†ç¾è±¡ã€‚",
     "patterns":[r"çµæœãŒè‰¯ã‹ã£ãŸ=æ­£ã—ã„åˆ¤æ–­", r"å¤±æ•—=åˆ¤æ–­ãŒæ‚ªã„"],
     "advice":[
         "æ„æ€æ±ºå®šã®**ãƒ—ãƒ­ã‚»ã‚¹å“è³ª**ã§è©•ä¾¡ã€‚",
         "å½“æ™‚å¾—ã‚‰ã‚ŒãŸ**æƒ…å ±ç¯„å›²**ã§å†æ¤œè¨¼ã€‚"
     ]},

    # 24 ã‚¢ã‚¯ã‚¿ãƒ¼ãƒã‚¤ã‚¢ã‚¹ï¼ˆè¡Œç‚ºè€…âˆ’è¦³å¯Ÿè€…åå·®ï¼‰
    {"key":"actorobserver","name":"ã‚¢ã‚¯ã‚¿ãƒ¼ãƒã‚¤ã‚¢ã‚¹",
     "desc":"è‡ªåˆ†ã®å¤±æ•—ã¯çŠ¶æ³ã®ã›ã„ã€ä»–äººã®å¤±æ•—ã¯æ€§æ ¼ã®ã›ã„ã«ã—ãŒã¡ã€‚",
     "patterns":[r"è‡ªåˆ†ã¯çŠ¶æ³ãŒæ‚ªã‹ã£ãŸ", r"ã‚ã®äººã¯æ€§æ ¼ãŒãƒ€ãƒ¡"],
     "advice":[
         "è‡ªåˆ†/ä»–äººã®è©•ä¾¡è»¸ã‚’**å…¥ã‚Œæ›¿ãˆã¦**æ›¸ãã€‚",
         "çŠ¶æ³è¦å› ã¨å€‹äººè¦å› ã‚’**åŒæ•°**æŒ™ã’ã‚‹ã€‚"
     ]},

    # 25 æ ¹æœ¬çš„å¸°å±ã®èª¤ã‚Š
    {"key":"fundamental","name":"æ ¹æœ¬çš„å¸°å±ã®èª¤ã‚Š",
     "desc":"ä»–è€…ã®è¡Œå‹•åŸå› ã‚’æ€§æ ¼ãªã©ã®å†…çš„è¦å› ã«éåº¦ã«æ±‚ã‚ã‚‹å‚¾å‘ã€‚",
     "patterns":[r"æ€ ã‘è€…ã ã‹ã‚‰å¤±æ•—", r"æ ¹ãŒã ã‚‰ã—ãªã„ã‹ã‚‰", r"æ€§æ ¼ãŒæ‚ªã„ã‹ã‚‰"],
     "advice":[
         "å¤–çš„è¦å› ï¼ˆåˆ¶åº¦/ç’°å¢ƒ/æƒ…å ±ï¼‰ã‚’æ›¸ãå‡ºã™ã€‚",
         "åŒã˜çŠ¶æ³ãªã‚‰è‡ªåˆ†ã¯ï¼Ÿ**åäº‹å®Ÿ**ã§è€ƒãˆã‚‹ã€‚"
     ]},

    # 26 ãƒã‚¸ãƒ†ã‚£ãƒ–éŒ¯èª¤ï¼ˆæ¥½è¦³ãƒã‚¤ã‚¢ã‚¹ï¼‰
    {"key":"optimism","name":"ãƒã‚¸ãƒ†ã‚£ãƒ–éŒ¯èª¤ï¼ˆæ¥½è¦³ãƒã‚¤ã‚¢ã‚¹ï¼‰",
     "desc":"è‡ªåˆ†ã ã‘ã¯ã†ã¾ãã„ã/å•é¡Œã¯èµ·ããªã„ã¨éå°è©•ä¾¡ã™ã‚‹å‚¾å‘ã€‚",
     "patterns":[r"è‡ªåˆ†ã ã‘ã¯å¤§ä¸ˆå¤«", r"ãªã‚“ã¨ã‹ãªã‚‹(ã¯ãš|ã§ã—ã‚‡ã†)"],
     "advice":[
         "ãƒªã‚¹ã‚¯ã‚’**ç¢ºç‡Ã—å½±éŸ¿**ã§è¦‹ç©ã‚‚ã‚Šã€‚",
         "ç¬¬ä¸‰è€…ã«**ãƒ‡ãƒ“ãƒ«ã‚ºã‚¢ãƒ‰ãƒœã‚±ã‚¤ãƒˆ**ã‚’ä¾é ¼ã€‚"
     ]},

    # 27 è¨ˆç”»éŒ¯èª¤
    {"key":"planning","name":"è¨ˆç”»éŒ¯èª¤",
     "desc":"å¿…è¦ãªæ™‚é–“ã‚„ã‚³ã‚¹ãƒˆã‚’ç”˜ãè¦‹ç©ã‚‚ã£ã¦ã—ã¾ã†å‚¾å‘ã€‚",
     "patterns":[r"ã™ãçµ‚ã‚ã‚‹", r"æƒ³å®šã‚ˆã‚Šæ™‚é–“ã¯(ã‹ã‹ã‚‰ãªã„|å°‘ãªã„)", r"è¦‹ç©ã‚‚ã‚Šã¯(æ¥½è¦³|æ§ãˆã‚)ã§è‰¯ã„"],
     "advice":[
         "éå»ã®å®Ÿç¸¾å€¤ã‹ã‚‰**ä¿‚æ•°**ã‚’æ›ã‘ã‚‹ï¼ˆä¾‹ï¼šÃ—1.5ï¼‰ã€‚",
         "ãƒãƒƒãƒ•ã‚¡ï¼ˆæ™‚é–“/è²»ç”¨ï¼‰ã‚’**æ˜ç¤º**ã€‚"
     ]},

    # 28 è‡ªå·±æˆå°±äºˆè¨€
    {"key":"selffulfilling","name":"è‡ªå·±æˆå°±äºˆè¨€",
     "desc":"â€œã©ã†ã›ç„¡ç†â€ã¨ã„ã†ä¿¡å¿µãŒè¡Œå‹•ã‚’æŠ‘åˆ¶ã—ã€çµæœçš„ã«å¤±æ•—ã‚’æ‹›ãç¾è±¡ã€‚",
     "patterns":[r"ã©ã†ã›(ç„¡ç†|å¤±æ•—)ã™ã‚‹", r"ã‚„ã£ã¦ã‚‚æ„å‘³ãŒãªã„"],
     "advice":[
         "æœ€å°ã®ä¸€æ­©ï¼ˆ5åˆ†/1ã‚¿ã‚¹ã‚¯ï¼‰ã«**åˆ†å‰²**ã—ã¦ç€æ‰‹ã€‚",
         "â€œæˆåŠŸæ¡ä»¶ã®æœ€å°ã‚»ãƒƒãƒˆâ€ã‚’å®šç¾©ã€‚"
     ]},

    # 29 æå¤±å›é¿
    {"key":"lossaversion","name":"æå¤±å›é¿",
     "desc":"åŒã˜å¤§ãã•ã®åˆ©ç›Šã‚ˆã‚Šæå¤±ã®ç—›ã¿ã‚’å¼·ãæ„Ÿã˜ã€æŒ‘æˆ¦ã‚’é¿ã‘ãŒã¡ã€‚",
     "patterns":[r"æã‚’ã—ãŸããªã„", r"ãƒªã‚¹ã‚¯ãŒæ€–ã„", r"ç¾çŠ¶ã®åˆ©ç›Šã‚’å®ˆã‚ŠãŸã„"],
     "advice":[
         "æå¤±ä¸Šé™ã‚’**å…ˆã«**æ±ºã‚ã€ãƒ«ãƒ¼ãƒ«åŒ–ã€‚",
         "å°ã•ãè©¦ã™**å®Ÿé¨“**ã§æœŸå¾…å€¤ã‚’æ¤œè¨¼ã€‚"
     ]},

    # 30 ç¾çŠ¶èªçŸ¥ã®æ­ªã¿ï¼ˆæ€ã„è¾¼ã¿ï¼‰
    {"key":"cognitivebias","name":"ç¾çŠ¶èªçŸ¥ã®æ­ªã¿ï¼ˆæ€ã„è¾¼ã¿ï¼‰",
     "desc":"å‰æã‚„è¦–ç‚¹ãŒå›ºå®šã•ã‚Œã¦ã€ä»–ã®å¯èƒ½æ€§ãŒè¦‹ãˆãªããªã‚‹çŠ¶æ…‹ã€‚",
     "patterns":[r"ä»–ã®é¸æŠè‚¢ãŒ(è¦‹ãˆãªã„|ãªã„)", r"å¸¸è­˜ã ã‹ã‚‰æ­£ã—ã„", r"æ˜”ã‹ã‚‰ãã†ã ã‹ã‚‰"],
     "advice":[
         "å‰æã‚’**1ã¤ãšã¤åè»¢**ã—ã¦å†æ¤œè¨ã€‚",
         "åˆ¥åˆ†é‡ã®**é¡ä¼¼ã‚±ãƒ¼ã‚¹**ã‚’å‚ç…§ã€‚"
     ]},
]

def _score_bias(text: str, item: dict) -> float:
    """ãƒ‘ã‚¿ãƒ¼ãƒ³ä¸€è‡´æ•°ã‚’ç°¡æ˜“ã‚¹ã‚³ã‚¢ã«ã€‚0.0ã€œ1.0"""
    hits = 0
    for pat in item["patterns"]:
        if re.search(pat, text, flags=re.IGNORECASE):
            hits += 1
    if not item["patterns"]:
        return 0.0
    # æ¤œå‡ºæ„Ÿåº¦ï¼šãƒ‘ã‚¿ãƒ¼ãƒ³ã®åŠåˆ†ï¼‹1ãƒ’ãƒƒãƒˆã§æº€ç‚¹ã«è¿‘ã¥ã
    denom = max(2, len(item["patterns"]) // 2 + 1)
    return min(1.0, hits / denom)

def _format_diag(name, desc, tips):
    tip = random.choice(tips) if tips else ""
    return (
        f"**{name}** ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n"
        f"{desc}\n"
        f"**è¦–é‡ã‚’åºƒã’ã‚‹ãƒ’ãƒ³ãƒˆ:** {tip}"
    )

def analyze_with_ai(text: str, category=None, top_n: int = 3) -> str:
    """
    å¤–éƒ¨APIã‚’ä½¿ã‚ãšã€æ–‡ç« ã®è¨€ã„å›ã—ã‹ã‚‰ä»£è¡¨çš„ãªãƒã‚¤ã‚¢ã‚¹ã‚’ç°¡æ˜“æ¨å®šã€‚
    é•·ã‚ã®â€œãƒ—ãƒè¨ºæ–­â€æ–‡ã‚’è¿”ã™ã€‚
    """
    t = (text or "").strip()
    if not t:
        return "å…¥åŠ›ãŒç©ºã§ã™ã€‚å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"

    # å„ãƒã‚¤ã‚¢ã‚¹ã®ã‚¹ã‚³ã‚¢ç®—å‡º
    scored = []
    for b in _BIASES:
        s = _score_bias(t, b)
        if s > 0:
            scored.append((s, b))
    scored.sort(key=lambda x: x[0], reverse=True)
    top = [b for _, b in scored[:max(1, top_n)]]

    header = f"ğŸ§  **å…¥åŠ›å†…å®¹:** {t}\nğŸ“‚ **ã‚«ãƒ†ã‚´ãƒª:** {category or 'æœªé¸æŠ'}\n---\n"
    if not top:
        body = ("ğŸ” ç›®ç«‹ã¤èªçŸ¥ãƒã‚¤ã‚¢ã‚¹ã¯ç‰¹ã«æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\n"
                "ã¨ã¯ã„ãˆã€åä¾‹ã‚„åˆ¥è¦–ç‚¹ã®æƒ…å ±ã‚’**æ„è­˜çš„ã«**é›†ã‚ã‚‹ç™–ã‚’ã¤ã‘ã‚‹ã¨ã€ã‚ˆã‚Šãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„åˆ¤æ–­ã«è¿‘ã¥ã‘ã¾ã™ã€‚")
    else:
        parts = []
        for b in top:
            parts.append(_format_diag(b["name"], b["desc"], b["advice"]))
        parts.append("ğŸ“Œ **ãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆ:** åå¯¾å´ã®æ„è¦‹ã‚„åˆ¥ã®å›½ãƒ»äº‹ä¾‹ã‚‚1ã¤å‚ç…§ã—ã¦ã‹ã‚‰çµè«–ã¥ã‘ã‚‹ã¨ã€åˆ¤æ–­ã®åã‚Šã‚’æ¸›ã‚‰ã›ã¾ã™ã€‚")
        body = "\n\n".join(parts)

    return header + "âœ… **AIãƒ—ãƒè¨ºæ–­**\n" + body
