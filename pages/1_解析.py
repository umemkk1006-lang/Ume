# -*- coding: utf-8 -*-
# pages/2_ãƒã‚¤ã‚¢ã‚¹è§£æ.py
import streamlit as st
import random
import datetime
from logic_simple import analyze_selection, render_finding_card

 
# =========================
# ãƒšãƒ¼ã‚¸å›ºæœ‰ã®ã‚­ãƒ¼ï¼ˆè¡çªé˜²æ­¢ï¼‰
# =========================
KEY_PREFIX = "p2_"
def k(name: str) -> str:
    return KEY_PREFIX + name

# =========================
# ãƒ¢ãƒã‚¤ãƒ«æœ€é©CSSï¼ˆèª­ã¿ã‚„ã™ã„æ–‡å­—ï¼‰
# =========================
st.markdown("""
<style>
.block-container{max-width:720px;margin:auto;}
h1{font-size:1.6rem !important;margin:1.8rem 0 1rem 0;}   /* â†ã‚¿ã‚¤ãƒˆãƒ«ã‚’å°‘ã—å¤§ãã */
h2, .stSubheader{font-size:1.1rem !important;}            /* â†ã‚µãƒ–è¦‹å‡ºã—ã‚’å°‘ã—å°ã•ã */
p, .stMarkdown{font-size:.95rem;line-height:1.6;}         
.small{color:#667085;font-size:.88rem;}
.stButton>button{font-size:.95rem;padding:.35rem 1rem;}
@media(max-width:480px){
    h1{font-size:1.4rem !important;}   /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯å°‘ã—æŠ‘ãˆã‚‹ */
    h2, .stSubheader{font-size:1.0rem !important;}
    p, .stMarkdown{font-size:.92rem;}
}
</style>
""", unsafe_allow_html=True)


# =========================
# ãƒ˜ãƒƒãƒ€ãƒ¼
# =========================
st.markdown("# ğŸ§  ãƒã‚¤ã‚¢ã‚¹è§£æï¼ˆã‹ã‚“ãŸã‚“ç‰ˆï¼‰")
st.caption("ã€Œâ€œæ€è€ƒã®ãƒã‚°â€ã‚’è¦‹ã¤ã‘ã¦ã€è„³ã®ä½¿ã„æ–¹ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ")

# =========================
# 3æ®µéš ã‹ã‚“ãŸã‚“å…¥åŠ›
# =========================
st.subheader("1) ã‹ã‚“ãŸã‚“å…¥åŠ›ï¼ˆ3ã‚¹ãƒ†ãƒƒãƒ—ï¼‰")

# STEP1: ãƒ†ãƒ¼ãƒï¼ˆã‚·ãƒ¼ãƒ³ï¼‰
THEMES = ["ãŠé‡‘", "å­¦ã³", "äººé–“é–¢ä¿‚", "è²·ã„ç‰©", "ä»•äº‹ãƒ»ãƒã‚¤ãƒˆ"]
theme = st.radio("A. ã©ã®ãƒ†ãƒ¼ãƒï¼Ÿ", THEMES, key=k("theme"))

# STEP2: çŠ¶æ³ï¼ˆç›®çš„ï¼‰
SITUATIONS = {
    "ãŠé‡‘": ["è²¯é‡‘ã—ãŸã„", "å‡ºè²»ã‚’æ¸›ã‚‰ã—ãŸã„", "æŠ•è³‡ãŒæ°—ã«ãªã‚‹"],
    "å­¦ã³": ["å‹‰å¼·ãŒç¶šã‹ãªã„", "è³‡æ ¼ã‚’å–ã‚ŠãŸã„", "éƒ¨æ´»ãƒ»å‹‰å¼·ã®ä¸¡ç«‹"],
    "äººé–“é–¢ä¿‚": ["LINEã®æ—¢èª­ãŒæ°—ã«ãªã‚‹", "æ–­ã‚Œãªãã¦å›°ã‚‹", "å‹ã ã¡ã«æ„è¦‹ãŒè¨€ãˆãªã„"],
    "è²·ã„ç‰©": ["é«˜ã„ç‰©ã‚’è²·ã†ã‹è¿·ã†", "ã‚»ãƒ¼ãƒ«ã§è¡å‹•è²·ã„", "ã‚µãƒ–ã‚¹ã‚¯ã®ç¶™ç¶š"],
    "ä»•äº‹ãƒ»ãƒã‚¤ãƒˆ": ["ã‚·ãƒ•ãƒˆã‚’å¢—ã‚„ã™ã‹è¿·ã†", "æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦", "ä¸Šæ‰‹ãé ¼ã‚Œãªã„"],
}
situation = st.selectbox("B. å…·ä½“çš„ãªçŠ¶æ³ã¯ï¼Ÿ", SITUATIONS[theme], key=k("situation"))

# STEP3: å¿ƒã®ã‚µã‚¤ãƒ³
SIGNS = ["æ™‚é–“ãŒãªã„æ°—ãŒã™ã‚‹", "æã™ã‚‹ã®ãŒæ€–ã„", "ã¿ã‚“ãªãŒã‚„ã£ã¦ã‚‹ã‹ã‚‰", "ãªã‚“ã¨ãªãä¸å®‰", "é¢å€’ã§å…ˆã®ã°ã—"]
sign = st.selectbox("C. ä»Šã®æ°—æŒã¡ã«è¿‘ã„ã‚‚ã®ã¯ï¼Ÿ", SIGNS, key=k("sign"))

st.markdown('<span class="small">ãƒ’ãƒ³ãƒˆï¼šAâ†’Bâ†’Cã‚’é¸ã¶ã¨â€œä»Šã®è‡ªåˆ†ã®æ€è€ƒã®ã‚¯ã‚»â€ãŒæµ®ãã‚„ã™ããªã‚Šã¾ã™ã€‚</span>', unsafe_allow_html=True)

# æ–‡ç« ï¼ˆä»»æ„ã€‚ãªãã¦ã‚‚OKï¼‰
st.subheader("2) ä¸€è¨€ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰")
user_text = st.text_area("ä»Šã®æ°—æŒã¡ã‚„çŠ¶æ³ã‚’1ã€œ3è¡Œã§ã€‚ç©ºã§ã‚‚OKã€‚", key=k("memo"), placeholder="ä¾‹ï¼‰ã‚»ãƒ¼ãƒ«ã§å®‰ã„ã¨èãã¨è²·ã‚ãªãã‚ƒæãªæ°—ãŒã—ã¦ç„¦ã‚‹ã€‚")

# =================
# è§£æãƒœã‚¿ãƒ³
# =================
if st.button("è§£æã™ã‚‹", type="primary", key=k("analyze_btn")):
    # ç°¡å˜è§£æãƒ­ã‚¸ãƒƒã‚¯ã‚’å‘¼ã¶
    findings = analyze_selection(theme, situation, sign, user_text)

    # çµæœã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ï¼ˆNoneé˜²æ­¢ï¼‰
    st.session_state[k("findings")] = findings or []

    st.success("è§£æã—ã¾ã—ãŸã€‚ä¸‹ã®çµæœã‚’ã”ç¢ºèªãã ã•ã„ã€‚")


# =========================
# è§£æçµæœã®è¡¨ç¤º
# =========================
st.subheader("3) è§£æçµæœ")
findings = st.session_state.get(k("findings"), None)

if findings is None:
    st.caption("ï¼ˆã¾ã è§£æã—ã¦ã„ã¾ã›ã‚“ï¼‰")
elif len(findings) == 0:
    st.success("ä»Šå›ã¯åã‚Šã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚è½ã¡ç€ã„ã¦è€ƒãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚")
    st.info("å‹ã ã¡ã«â€œã©ã†è€ƒãˆãŸã‹â€ã‚’èª¬æ˜ã—ã¦ã¿ã‚‹ã¨ã€ã•ã‚‰ã«åˆ¤æ–­ãŒå¼·ããªã‚Šã¾ã™ã€‚")
else:
    st.caption("â€» â€œç¢ºã‹ã‚‰ã—ã•â€ã¯A/B/Cã®3æ®µéšï¼ˆA:é«˜ã„ï½œB:ä¸­ãã‚‰ã„ï½œC:ä½ã‚ï¼‰")
    for f in findings:
        render_finding_card(f)

# =========================
# å‹ã ã¡ã«è©±ã—ãŸããªã‚‹å°ãƒã‚¿ï¼ˆ1ã¤ã ã‘è¡¨ç¤ºï¼‰
# =========================


# æ—¥æ›¿ã‚ã‚Šã§å¤‰ã‚ã‚‹ã‚ˆã†ã«ã‚·ãƒ¼ãƒ‰è¨­å®šï¼ˆåŒã˜æ—¥ã¯å›ºå®šï¼‰
random.seed(datetime.date.today().isoformat())

TIPS = [
    {"title": "ãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°åŠ¹æœ", "body": "åŒã˜å†…å®¹ã§ã‚‚â€œè¡¨ç¾ã®ä»•æ–¹â€ã«ã‚ˆã£ã¦å°è±¡ãŒå¤‰ã‚ã‚‹å¿ƒç†ã€‚ãƒã‚¸ãƒ†ã‚£ãƒ–ãªè¨€ã„æ–¹ã ã¨è‰¯ãè¦‹ãˆã€ãƒã‚¬ãƒ†ã‚£ãƒ–ã ã¨æ‚ªãè¦‹ãˆã‚‹ã€‚ä¾‹ï¼šã€90ï¼…æˆåŠŸã€vsã€10ï¼…å¤±æ•—ã€ã€‚"},
    {"title": "ã‚¢ãƒ³ã‚«ãƒªãƒ³ã‚°åŠ¹æœ", "body": "æœ€åˆã«è¦‹ãŸæ•°å­—ã‚„æƒ…å ±ãŒâ€œå¿ƒã®åŸºæº–â€ã¨ãªã‚Šã€ãã®å¾Œã®åˆ¤æ–­ã‚’å·¦å³ã™ã‚‹ã€‚ä¾‹ï¼šã€å®šä¾¡10ä¸‡å††â†’7ä¸‡å††ã€ã¨èãã¨ã€æœ¬å½“ã¯7ä¸‡å††ãŒå¦¥å½“ã§ã‚‚ãŠå¾—ã«æ„Ÿã˜ã‚‹ã€‚"},
    {"title": "ç¾çŠ¶ç¶­æŒãƒã‚¤ã‚¢ã‚¹", "body": "äººã¯å¤‰åŒ–ã‚ˆã‚Šã‚‚â€œä»Šã®ã¾ã¾â€ã‚’é¸ã³ãŒã¡ã€‚å¤‰ãˆã‚‹ã“ã¨ã«ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ä½¿ã†ã‚ˆã‚Šã€ç¶­æŒã™ã‚‹æ–¹ãŒå®‰å¿ƒã«æ„Ÿã˜ã‚‹ã€‚ä¾‹ï¼šå¤ã„ç¿’æ…£ã‚„è·å ´ã«ç•™ã¾ã‚Šç¶šã‘ã‚‹ã€‚"},
    {"title": "ç¢ºè¨¼ãƒã‚¤ã‚¢ã‚¹", "body": "è‡ªåˆ†ã®ä¿¡ã˜ãŸã„æƒ…å ±ã°ã‹ã‚Šé›†ã‚ã€åå¯¾æ„è¦‹ã‚’ç„¡è¦–ã—ã¦ã—ã¾ã†å‚¾å‘ã€‚ä¾‹ï¼šãƒ€ã‚¤ã‚¨ãƒƒãƒˆæ–¹æ³•ã‚’æ¢ã™æ™‚ã«ã€è‡ªåˆ†ã«éƒ½åˆã®è‰¯ã„æƒ…å ±ã°ã‹ã‚Šä¿¡ã˜ã‚‹ã€‚"},
    {"title": "æå¤±å›é¿ãƒã‚¤ã‚¢ã‚¹", "body": "äººã¯â€œå¾—ã™ã‚‹å–œã³â€ã‚ˆã‚Šâ€œæã™ã‚‹ç—›ã¿â€ã‚’å¼·ãæ„Ÿã˜ã‚‹å¿ƒç†ã€‚ä¾‹ï¼š500å††å¾—ã™ã‚‹ã‚ˆã‚Šã€500å††å¤±ã†æ–¹ãŒã‚·ãƒ§ãƒƒã‚¯ãŒå¤§ãã„ã€‚"},
    {"title": "ä»£è¡¨æ€§ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯", "body": "è¦‹ãŸç›®ã‚„å°è±¡ãŒâ€œå…¸å‹çš„â€ã ã¨æ„Ÿã˜ã‚‹ã ã‘ã§ã€ç¢ºç‡ã‚’èª¤ã‚‹å‚¾å‘ã€‚ä¾‹ï¼šç™½è¡£ã‚’ç€ãŸäººã‚’åŒ»è€…ã ã¨æ€ã„è¾¼ã‚€ã€‚"},
    {"title": "ãƒãƒ­ãƒ¼åŠ¹æœ", "body": "ä¸€ã¤ã®å°è±¡ï¼ˆè¦‹ãŸç›®ã‚„è‚©æ›¸ï¼‰ãŒã€å…¨ä½“è©•ä¾¡ã«å½±éŸ¿ã™ã‚‹å¿ƒç†ã€‚ä¾‹ï¼šã‚¤ã‚±ãƒ¡ãƒ³ã ã‹ã‚‰ä»•äº‹ã‚‚ã§ãã‚‹ã¨æ€ã„è¾¼ã‚€ã€‚"},
    {"title": "é¸æŠã®ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹", "body": "é¸æŠè‚¢ãŒå¤šã™ãã‚‹ã¨æº€è¶³åº¦ãŒä¸‹ãŒã‚‹å¿ƒç†ã€‚ä¾‹ï¼šãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒå¤šã„ã¨ã€é¸ã‚“ã å¾Œã«â€œä»–ã®æ–¹ãŒè‰¯ã‹ã£ãŸã‹ã‚‚â€ã¨æ„Ÿã˜ã‚‹ã€‚"},
    {"title": "è¨ˆç”»éŒ¯èª¤", "body": "è‡ªåˆ†ã®è¨ˆç”»ã‚’â€œæ¥½è¦³çš„â€ã«è¦‹ç©ã‚‚ã‚‹å‚¾å‘ã€‚ä¾‹ï¼šãƒ¬ãƒãƒ¼ãƒˆã‚’1æ—¥ã§çµ‚ã‚ã‚‹ã¨æ€ã£ã¦ã‚‚ã€çµå±€3æ—¥ã‹ã‹ã‚‹ã€‚"},
    {"title": "ç¤¾ä¼šçš„è¨¼æ˜", "body": "å¤šãã®äººãŒã—ã¦ã„ã‚‹è¡Œå‹•ã‚’â€œæ­£ã—ã„â€ã¨æ„Ÿã˜ã‚‹å¿ƒç†ã€‚ä¾‹ï¼šè¡Œåˆ—ãŒã‚ã‚‹ãŠåº—ã‚’è¦‹ã¦â€œäººæ°—ã ã‹ã‚‰ç¾å‘³ã—ã„ã«é•ã„ãªã„â€ã¨æ€ã†ã€‚"},
    {"title": "ãƒ—ãƒ­ã‚¹ãƒšã‚¯ãƒˆç†è«–", "body": "äººã¯â€œç¢ºå®Ÿãªå¾—â€ã‚’é¸ã³ã€â€œç¢ºå®Ÿãªæâ€ã‚’é¿ã‘ã‚ˆã†ã¨ã™ã‚‹å‚¾å‘ã€‚ä¾‹ï¼š50ï¼…ã§1ä¸‡å††ã‚ˆã‚Šã€ç¢ºå®Ÿã«5,000å††ã‚’é¸ã¶ã€‚"},
    {"title": "ã‚µãƒ³ã‚¯ã‚³ã‚¹ãƒˆåŠ¹æœ", "body": "ã“ã‚Œã¾ã§ã®æŠ•è³‡ã‚’ç„¡é§„ã«ã—ãŸããªãã¦ã‚„ã‚ã‚‰ã‚Œãªã„å¿ƒç†ã€‚ä¾‹ï¼šé€”ä¸­ã§ã¤ã¾ã‚‰ãªã„æ˜ ç”»ã§ã‚‚â€œãŠé‡‘ã‚’æ‰•ã£ãŸã‹ã‚‰â€æœ€å¾Œã¾ã§è¦‹ã‚‹ã€‚"},
    {"title": "å¾ŒçŸ¥æµãƒã‚¤ã‚¢ã‚¹", "body": "çµæœã‚’è¦‹ãŸå¾Œã«ã€ãã†ãªã‚‹ã¨æ€ã£ã¦ãŸã€ã¨æ„Ÿã˜ã‚‹éŒ¯è¦šã€‚ä¾‹ï¼šæ ªä¾¡ãŒä¸ŠãŒã£ãŸå¾Œã§â€œã‚„ã£ã±ã‚Šè²·ãˆã°ã‚ˆã‹ã£ãŸâ€ã¨æ€ã†ã€‚"},
    {"title": "è‡ªå·±å¥‰ä»•ãƒã‚¤ã‚¢ã‚¹", "body": "æˆåŠŸã¯è‡ªåˆ†ã®åŠ›ã€å¤±æ•—ã¯å¤–éƒ¨ã®ã›ã„ã«ã™ã‚‹å‚¾å‘ã€‚ä¾‹ï¼šè©¦é¨“ã«å—ã‹ã£ãŸã‚‰â€œåŠªåŠ›ã®çµæœâ€ã€è½ã¡ãŸã‚‰â€œå•é¡ŒãŒæ‚ªã„â€ã€‚"},
    {"title": "æ™‚é–“å‰²å¼•", "body": "å°†æ¥ã®åˆ©ç›Šã‚ˆã‚Šâ€œä»Šã™ãã®å¿«æ¥½â€ã‚’å„ªå…ˆã™ã‚‹å¿ƒç†ã€‚ä¾‹ï¼šå°†æ¥ã®å¥åº·ã‚ˆã‚Šã€ä»Šã®ã‚¹ã‚¤ãƒ¼ãƒ„ã‚’é¸ã‚“ã§ã—ã¾ã†ã€‚"},
    {"title": "æ¥½è¦³ãƒã‚¤ã‚¢ã‚¹", "body": "è‡ªåˆ†ã¯ä»–äººã‚ˆã‚Šå¤±æ•—ã—ã«ãã„ã¨æ€ã†éŒ¯è¦šã€‚ä¾‹ï¼šè‡ªåˆ†ã ã‘ã¯äº‹æ•…ã«é­ã‚ãªã„ã¨ä¿¡ã˜ã¦é‹è»¢ã™ã‚‹ã€‚"},
    {"title": "æ¨©å¨ãƒã‚¤ã‚¢ã‚¹", "body": "å°‚é–€å®¶ã‚„æœ‰åäººã®æ„è¦‹ã‚’éå¤§è©•ä¾¡ã™ã‚‹å¿ƒç†ã€‚ä¾‹ï¼šæœ‰åäººãŒç´¹ä»‹ã—ãŸã‚µãƒ—ãƒªã‚’æ ¹æ‹ ãªãä¿¡ã˜ã‚‹ã€‚"},
    {"title": "åŒèª¿ãƒã‚¤ã‚¢ã‚¹", "body": "å‘¨å›²ã®æ„è¦‹ã«åˆã‚ã›ã™ãã¦è‡ªåˆ†ã®è€ƒãˆã‚’å¤±ã†å‚¾å‘ã€‚ä¾‹ï¼šã¿ã‚“ãªãŒè³›æˆã—ã¦ã„ã‚‹ä¼šè­°ã§åå¯¾æ„è¦‹ã‚’è¨€ãˆãªã„ã€‚"},
    {"title": "åˆ©ç”¨å¯èƒ½æ€§ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯", "body": "æ€ã„å‡ºã—ã‚„ã™ã„å‡ºæ¥äº‹ã‚’â€œé »ç¹â€ã ã¨éŒ¯è¦šã™ã‚‹ã€‚ä¾‹ï¼šãƒ‹ãƒ¥ãƒ¼ã‚¹ã§äº‹æ•…ã‚’è¦‹ãŸå¾Œã€â€œäº¤é€šäº‹æ•…ã¯å¤šã„â€ã¨æ„Ÿã˜ã‚‹ã€‚"},
    {"title": "æ„Ÿæƒ…ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯", "body": "æ„Ÿæƒ…ã§åˆ¤æ–­ã—ã¦ã—ã¾ã†å‚¾å‘ã€‚ä¾‹ï¼šä¸å®‰ã§æ ªã‚’å£²ã‚‹ã€å¬‰ã—ãã¦è¡å‹•è²·ã„ã™ã‚‹ã€‚"},
    {"title": "ã‚´ãƒ¼ãƒ«ãƒ»ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ", "body": "ç›®æ¨™ã«è¿‘ã¥ãã»ã©ã‚„ã‚‹æ°—ãŒå¢—ã™å¿ƒç†ã€‚ä¾‹ï¼šã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰ãŒã‚ã¨2å€‹ã§æº€ã‚¿ãƒ³ã«ãªã‚‹ã¨æ€¥ã«é ‘å¼µã‚‹ã€‚"},
    {"title": "ãƒŠãƒƒã‚¸åŠ¹æœ", "body": "äººã®è¡Œå‹•ã‚’â€œã•ã‚Šã’ãªãèª˜å°â€ã™ã‚‹ä»•çµ„ã¿ã€‚ä¾‹ï¼šå¥åº·é£Ÿå“ã‚’æ£šã®ç›®ç·šã®é«˜ã•ã«ç½®ãã¨è³¼å…¥ç‡ãŒä¸ŠãŒã‚‹ã€‚"},
    {"title": "ãƒªãƒã‚¦ãƒ³ãƒ‰åŠ¹æœ", "body": "ç¯€ç´„ã‚„ãƒ€ã‚¤ã‚¨ãƒƒãƒˆã®åˆ¶é™ãŒåå‹•ã‚’ç”Ÿã‚€ç¾è±¡ã€‚ä¾‹ï¼šç”˜ã„ç‰©ã‚’æˆ‘æ…¢ã—ã™ãã¦ã€å¾Œã§ãƒ‰ã‚«é£Ÿã„ã™ã‚‹ã€‚"},
    {"title": "ã‚¼ã‚¤ã‚¬ãƒ«ãƒ‹ã‚¯åŠ¹æœ", "body": "â€œé€”ä¸­ã®ã“ã¨â€ã‚’ã‚ˆãè¦šãˆã¦ã„ã‚‹å¿ƒç†ã€‚ä¾‹ï¼šãƒ‰ãƒ©ãƒãŒä¸­é€”åŠç«¯ã§çµ‚ã‚ã‚‹ã¨æ¬¡å›ãŒæ°—ã«ãªã‚‹ã€‚"},
    {"title": "æŠ•è³‡å®¶ãƒã‚¤ã‚¢ã‚¹", "body": "è‡ªåˆ†ã®ä¿æœ‰æ ªã‚’éå¤§è©•ä¾¡ã™ã‚‹å¿ƒç†ã€‚ä¾‹ï¼šä¸‹ãŒã£ã¦ã‚‚â€œãã®ã†ã¡ä¸ŠãŒã‚‹â€ã¨ä¿¡ã˜ã¦å£²ã‚Œãªã„ã€‚"},
    {"title": "æ‰€æœ‰åŠ¹æœ", "body": "è‡ªåˆ†ã®æŒã¡ç‰©ã‚’å®Ÿéš›ã‚ˆã‚Šé«˜ãè©•ä¾¡ã™ã‚‹å¿ƒç†ã€‚ä¾‹ï¼šè‡ªåˆ†ã®å¤ç€ã¯é«˜ãå£²ã‚Œã‚‹ã¨æ€ã„è¾¼ã‚€ã€‚"},
    {"title": "ã‚¢ãƒ³ãƒ“ãƒãƒ¬ãƒ³ã‚¹åŠ¹æœ", "body": "å¥½ãã¨å«Œã„ãŒåŒæ™‚ã«å­˜åœ¨ã™ã‚‹å¿ƒã®ã‚†ã‚‰ãã€‚ä¾‹ï¼šæ–°ã—ã„ç’°å¢ƒã«ãƒ¯ã‚¯ãƒ¯ã‚¯ã—ã¤ã¤ã€ä¸å®‰ã‚‚æ„Ÿã˜ã‚‹ã€‚"},
    {"title": "ç¢ºç‡ã®éŒ¯è¦š", "body": "å°ã•ãªç¢ºç‡ã‚’éå¤§è©•ä¾¡ã™ã‚‹å‚¾å‘ã€‚ä¾‹ï¼šå®ãã˜ã®å½“é¸ã‚’â€œè‡ªåˆ†ã«ã‚‚èµ·ã“ã‚Šãã†â€ã¨æ„Ÿã˜ã‚‹ã€‚"},
    {"title": "é¸æŠçš„æ³¨æ„", "body": "è‡ªåˆ†ãŒé–¢å¿ƒã‚ã‚‹æƒ…å ±ã°ã‹ã‚Šç›®ã«å…¥ã‚Šã€ä»–ã‚’è¦‹è½ã¨ã™ã€‚ä¾‹ï¼šæ¬²ã—ã„è»Šã®åºƒå‘Šã°ã‹ã‚Šç›®ã«ã¤ãã€‚"},
    {"title": "ãƒ€ãƒ‹ãƒ³ã‚°ï¼ã‚¯ãƒ«ãƒ¼ã‚¬ãƒ¼åŠ¹æœ", "body": "çŸ¥è­˜ãŒæµ…ã„äººã»ã©è‡ªä¿¡éå‰°ã«ãªã‚‹å‚¾å‘ã€‚ä¾‹ï¼šåˆå¿ƒè€…ãŒâ€œã‚‚ã†å®Œç’§ã«ç†è§£ã—ãŸâ€ã¨æ€ã„è¾¼ã‚€ã€‚"}
]

VERSION = "tips-2025-10-19-01"  # â†é©å½“ã«æ›´æ–°
st.caption(f"è±†çŸ¥è­˜ãƒ‡ãƒ¼ã‚¿: {VERSION}")

# å¤‰æ›´ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆæ‰‹ã§ä¸Šã’ã‚‹ï¼‰â€”â€” ç”»é¢ã«ã‚‚å‡ºã™
VERSION = "tips-2025-10-19-02"
st.caption(f"è±†çŸ¥è­˜ãƒ‡ãƒ¼ã‚¿ï¼š{VERSION}")

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤‰ã‚ã£ãŸã‚‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æƒé™¤
if st.session_state.get("tips_version") != VERSION:
    for k in ("tips_seen", "tips_clicks"):
        st.session_state.pop(k, None)
    try:
        st.cache_data.clear()
        st.cache_resource.clear()
    except Exception:
        pass
    st.session_state["tips_version"] = VERSION
    st.rerun()

# ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ€å°é™ã®ã‚­ãƒ¼ï¼ˆãƒ—ãƒ¼ãƒ«ã¯æŒãŸãªã„ï¼‰
if "tips_seen" not in st.session_state:
    st.session_state["tips_seen"] = set()
if "tips_clicks" not in st.session_state:
    st.session_state["tips_clicks"] = 0

def pick_next_tip() -> dict:
    """æœªè¡¨ç¤ºã®ã‚‚ã®ã‹ã‚‰ 1 ä»¶ã€‚å°½ããŸã‚‰è‡ªå‹•ãƒªã‚»ãƒƒãƒˆã€‚"""
    n = len(TIPS)
    remaining = [i for i in range(n) if i not in st.session_state["tips_seen"]]
    if not remaining:
        st.session_state["tips_seen"] = set()
        remaining = list(range(n))
    # â€œä»Šæ—¥ + ã‚¯ãƒªãƒƒã‚¯å›æ•°â€ ã‚’ç¨®ã«ã—ã¦æ¯å›å¤‰ã‚ã‚‹ãŒæ—¥å†…ã¯å†ç¾æ€§ã‚ã‚Š
    seed = f"{datetime.date.today().isoformat()}-{st.session_state['tips_clicks']}"
    rng = random.Random(seed)
    idx = rng.choice(remaining)
    st.session_state["tips_seen"].add(idx)
    return TIPS[idx]

with st.expander("ãŠã¾ã‘ï¼šä»Šæ—¥ã®è±†çŸ¥è­˜", expanded=True):
    tip = pick_next_tip()                      # â† ãƒœã‚¿ãƒ³ã®â€œä¸Šâ€ã« 1ä»¶ã ã‘å‡ºã™
    st.markdown(f"**{tip['title']}**ï¼š{tip['body']}")
    if st.button("åˆ¥ã®è±†çŸ¥è­˜ã‚‚è¦‹ã‚‹", key="see_another_tip"):
        st.session_state["tips_clicks"] += 1
        st.rerun()


